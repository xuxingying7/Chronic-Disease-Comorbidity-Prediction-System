# 疾病预测系统 - 机器学习集成说明

## 🚀 系统概述

本系统已成功集成您提供的机器学习代码，实现了完整的端到端机器学习流程：

### 核心功能
1. **数据预处理** - 多重插补和数据划分
2. **模型训练** - 6种机器学习模型训练
3. **性能评估** - 全面的模型评估指标
4. **可视化展示** - 交互式图表和结果展示

### 集成的机器学习模型
- **XGBoost** - 梯度提升决策树
- **随机森林** - Random Forest
- **朴素贝叶斯** - Naive Bayes
- **逻辑回归** - Logistic Regression
- **决策树** - Decision Tree
- **神经网络** - Multi-layer Perceptron

## 🏗️ 系统架构

```
系统架构
├── 前端 (React + Ant Design)
│   ├── 基础数据分析
│   └── 机器学习分析
└── 后端 (Python Flask API)
    ├── 数据预处理模块
    ├── 模型训练模块
    └── 模型评估模块
```

## 📋 启动步骤

### 第一步：启动后端API服务

1. **进入backend目录**：
   ```bash
   cd backend
   ```

2. **启动后端服务**：
   - **Windows（推荐）**:
     ```powershell
     python -m venv venv
     ./venv/Scripts/pip.exe install -r requirements.txt
     ./venv/Scripts/python.exe app.py
     ```
   - 或者直接在项目根目录运行 `start.ps1` 或双击 `start.bat`，会自动在后台启动后端

3. **验证API服务**：
   - 打开浏览器访问: http://localhost:5000/api/health
   - 看到 "机器学习API服务正常运行" 即表示成功

### 第二步：启动前端应用

1. **进入web目录**：
   ```bash
   cd web
   ```

2. **启动前端服务**：
   - **Windows**: 双击 `start.bat`
   - **手动启动**:
     ```bash
     npm install
     npm start
     ```

3. **访问系统**：
   - 浏览器会自动打开: http://localhost:3000
   - 点击"数据分析"菜单

## 🔧 使用流程

### 1. 基础分析
- 查看预设的CHARLS数据统计信息
- 浏览相关性分析结果
- 查看患病率分布图表

### 2. 机器学习分析

#### 步骤1：数据上传
- 切换到"机器学习分析"标签页
- 上传Excel格式的数据文件(.xlsx 或 .xls)
- 系统会自动显示数据基本信息

#### 步骤2：数据预处理
- 点击"开始预处理"按钮
- 系统会自动执行：
  - 多重插补（处理缺失值）
  - 数据划分（70%训练集，30%测试集）

#### 步骤3：模型训练
- 点击"训练模型"按钮
- 系统会并行训练6种机器学习模型
- 每个模型都会进行参数调优和交叉验证

#### 步骤4：结果查看
- **性能比较图表**：柱状图显示各模型的准确率和F1分数
- **详细评估表格**：显示所有评估指标

## 📊 评估指标说明

### 训练集和测试集指标
- **准确率 (Accuracy)**: 正确预测的比例
- **精确率 (Precision)**: 预测为正例中实际为正例的比例
- **召回率 (Recall)**: 实际正例中被正确预测的比例
- **F1分数 (F1-Score)**: 精确率和召回率的调和平均
- **均方误差 (MSE)**: 预测值与真实值差异的平方平均
- **均方根误差 (RMSE)**: MSE的平方根
- **R²系数**: 模型解释方差的比例
- **对数损失 (Log Loss)**: 概率预测的对数损失
- **AUC-ROC**: ROC曲线下面积

## 🔄 数据格式要求

### Excel文件格式
- **文件类型**: .xlsx 或 .xls
- **数据结构**: 
  - 第一行为列标题
  - 最后一列为目标变量（标签）
  - 其他列为特征变量
- **数据类型**: 支持数值型和分类型数据
- **缺失值**: 系统会自动处理缺失值

### 示例数据格式
```
年龄  | 性别 | 收入 | 教育 | ... | 慢性病
-----|------|------|------|-----|-------
65   | 男   | 3000 | 小学 | ... | 1
58   | 女   | 4500 | 中学 | ... | 0
...  | ...  | ...  | ...  | ... | ...
```

## 🛠️ 技术实现细节

### 数据预处理
- **多重插补**: 使用随机森林回归进行5次插补，取平均值
- **特征编码**: 自动处理分类变量的标签编码
- **数据标准化**: 对需要的模型自动应用特征标准化

### 模型训练
- **超参数优化**: 使用网格搜索和交叉验证
- **并行处理**: 多个模型同时训练提高效率
- **错误处理**: 单个模型失败不影响其他模型

### API接口
- **RESTful API**: 标准的HTTP接口
- **错误处理**: 完善的错误信息返回
- **文件管理**: 自动处理上传文件的存储和清理

## ❗ 常见问题解决

### 后端API启动失败
1. **检查Python版本**: 需要Python 3.8+
2. **安装依赖**: `pip install -r requirements.txt`
3. **端口占用**: 确保5000端口没有被占用
4. **防火墙**: 检查防火墙是否阻止了5000端口

### 前端连接失败
1. **检查API状态**: 访问 http://localhost:5000/api/health
2. **CORS问题**: 确保后端已启用CORS
3. **网络连接**: 检查本地网络连接

### 模型训练失败
1. **数据格式**: 检查Excel文件格式是否正确
2. **内存不足**: 对于大数据集，可能需要更多内存
3. **依赖包**: 确保所有Python包都已正确安装

### 文件上传失败
1. **文件大小**: 默认限制16MB，可在后端配置修改
2. **文件格式**: 只支持.xlsx和.xls格式
3. **文件权限**: 确保文件没有被其他程序占用

## 🎯 使用建议

### 数据准备
- 确保数据质量，减少噪声数据
- 特征工程可以在Excel中预先完成
- 目标变量应为0/1二分类格式

### 模型选择
- 根据数据特点选择合适的模型
- 关注多个评估指标，不只看准确率
- 考虑模型的可解释性需求

### 性能优化
- 对于大数据集，考虑数据采样
- 适当调整模型参数
- 使用更强大的硬件配置

## 🔮 扩展功能

系统支持进一步扩展：
- 添加更多机器学习模型
- 实现模型持久化和重用
- 增加特征重要性分析
- 支持实时预测接口
- 添加模型解释功能

---

**技术支持**: 如果遇到问题，请检查控制台日志或联系技术支持团队。
